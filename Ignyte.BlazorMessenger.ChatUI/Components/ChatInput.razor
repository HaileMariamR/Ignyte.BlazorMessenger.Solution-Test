@using Ignyte.BlazorMessenger.DataLayer.Models
@using Microsoft.AspNetCore.Components


<div class="message-form">
        <div class="form-row">
            @* Date picker (optional) *@
            <div class="schedule-section">
                <input type="datetime-local" id="scheduledTime" @bind="ScheduledTimeString" class="small-datetime" />
            </div>

            @* Message input and send button  *@
            <div class="input-section">
                <textarea @bind="MessageText" placeholder="Type your message..." rows="2"></textarea>
                <button type="button" @onclick="work">Send</button>
            </div>
        </div>
</div>

@code {
    [Parameter] public EventCallback<Message> OnSend { get; set; }

    private string MessageText = string.Empty;
    private string ScheduledTimeString = "";
    private async Task HandleSubmit()
    {
        if (string.IsNullOrWhiteSpace(MessageText))
            return;

        var message = new Message
        {
            Text = MessageText,
            DateTimeSent = DateTime.UtcNow
        };

        var now = DateTime.UtcNow;

        if (DateTime.TryParse(ScheduledTimeString, out var scheduledTime) && scheduledTime > now)
        {
            message.IsScheduled = true;
            message.ScheduledFor = scheduledTime;
        }
        else
        {
            message.WasSent = true;
        }

        await OnSend.InvokeAsync(message);
        MessageText = string.Empty;
        ScheduledTimeString = "";
    }
}