@using Ignyte.BlazorMessenger.UI.Models
@using Microsoft.AspNetCore.Components

<div class="message-form">
    <div class="form-row">
        @* Date picker (optional) *@
        <div class="schedule-section">
            <input type="datetime-local" id="scheduledTime" @bind="ScheduledTime" class="small-datetime" />
        </div>

        @* Message input and send button *@
        <div class="input-section">
            <textarea @bind="MessageText" placeholder="Type your message..." rows="2"></textarea>
            <button type="button" @onclick="HandleSubmit">Send</button>
        </div>
    </div>
</div>

@code {
    [Parameter] public EventCallback<Message> OnSend { get; set; }

    private string MessageText { get; set; } = string.Empty;
    private DateTime? ScheduledTime { get; set; } = null;

    private async Task HandleSubmit()
    {
        if (string.IsNullOrWhiteSpace(MessageText))
            return;

        var message = new Message
        {
            Text = MessageText,
            DateTimeSent = DateTime.UtcNow
        };

        var now = DateTime.UtcNow;

        if (ScheduledTime.HasValue && ScheduledTime.Value > now)
        {
            message.IsScheduled = true;
            message.ScheduledFor = ScheduledTime.Value;
        }
        else
        {
            message.WasSent = true;
        }

        await OnSend.InvokeAsync(message);

        // reset inputs
        MessageText = string.Empty;
        ScheduledTime = null;
    }
}
